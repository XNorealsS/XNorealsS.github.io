<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice-based Chat with AI</title>
</head>
<body>
    <h1>Voice-based Chat with AI</h1>
    <button id="start">Start Listening</button>
    <p id="status">Status: Waiting for input...</p>
    <p id="response"></p>

    <script>
        // Web Speech API - Speech Recognition (Speech to Text)
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'id-ID'; // Set language to Indonesian, or change based on preference
        recognition.continuous = false;
        recognition.interimResults = false;

        // Web Speech API - Speech Synthesis (Text to Speech)
        const synth = window.speechSynthesis;

        const API_KEY = 'sk-u2Uzr4vDRc6yhZmyI13zzvUU8Lca1FhpNFZsD5jNz4zfZmB8'; // Ganti dengan API Key Anda
        const API_URL = 'https://api.chatanywhere.tech'; // Ubah menjadi api.chatanywhere.org jika di luar negeri

        // Function to speak (Text to Speech)
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'id-ID'; // Indonesian language
            synth.speak(utterance);
        }

        // Function to handle when Speech Recognition starts
        recognition.onstart = function() {
            document.getElementById('status').textContent = "Status: Listening...";
        };

        // Function to handle when Speech Recognition returns a result
        recognition.onresult = async function(event) {
            const speechResult = event.results[0][0].transcript;
            document.getElementById('response').textContent = "You said: " + speechResult;
            document.getElementById('status').textContent = "Status: Thinking...";

            // Kirim permintaan ke API ChatAnywhere
            const aiResponse = await getAIResponse(speechResult);

            // Speak out AI's response (Text to Speech)
            speak(aiResponse);

            // Update UI with AI's response
            document.getElementById('response').textContent = "AI: " + aiResponse;
            document.getElementById('status').textContent = "Status: Done";
        };

        // Error handling
        recognition.onerror = function(event) {
            document.getElementById('status').textContent = "Status: Error - " + event.error;
        };

        // Start listening when user clicks the button
        document.getElementById('start').addEventListener('click', function() {
            recognition.start();
        });

        // Function to get response from AI API
        async function getAIResponse(userInput) {
            const requestBody = {
                model: "gpt-3.5-turbo",  // Atau gpt-4o-mini sesuai dengan model yang Anda pilih
                prompt: userInput,
                max_tokens: 150,
                temperature: 0.7,
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`, // Gunakan API Key
                    },
                    body: JSON.stringify(requestBody),
                });

                const data = await response.json();
                if (data && data.choices && data.choices[0]) {
                    return data.choices[0].text.trim(); // Mengembalikan respons dari AI
                } else {
                    return "Maaf, saya tidak mengerti permintaan Anda.";
                }
            } catch (error) {
                console.error("Error calling API:", error);
                return "Terjadi kesalahan, coba lagi nanti.";
            }
        }
    </script>
</body>
</html>